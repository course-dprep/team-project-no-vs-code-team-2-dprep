---
title: "data_exploration"
output: html_document
date: "2024-09-25"
---
```{r, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE)
```

```{r include=FALSE}
# Load packages
library(dplyr)
library(stringr)
library(tidyverse)
library(scales)
```

```{r include=FALSE}
# Importing the data set 
movies <- read_csv("../../gen/data-preparation/output/movies.csv")
```


```{r echo=FALSE}
# runtime x rating 

# Create a data frame for the average rating per runtime category
runtime_avg_rating <- data.frame(
  Runtime_Category = c("0-30 min", "30-60 min", "60-90 min", "90-120 min", "120-150 min", "150-180 min", ">180 min"),
  Average_Rating = c(
    mean(movies$averageRating[movies$`0-30 min` == TRUE], na.rm = TRUE),
    mean(movies$averageRating[movies$`30-60 min` == TRUE], na.rm = TRUE),
    mean(movies$averageRating[movies$`60-90 min` == TRUE], na.rm = TRUE),
    mean(movies$averageRating[movies$`90-120 min` == TRUE], na.rm = TRUE),
    mean(movies$averageRating[movies$`120-150 min` == TRUE], na.rm = TRUE),
    mean(movies$averageRating[movies$`150-180 min` == TRUE], na.rm = TRUE),
    mean(movies$averageRating[movies$`>180 min` == TRUE], na.rm = TRUE)
  )
)

runtime_avg_rating$Runtime_Category <- factor(runtime_avg_rating$Runtime_Category, 
                                              levels = c("0-30 min", "30-60 min", "60-90 min", "90-120 min", 
                                                         "120-150 min", "150-180 min", ">180 min"))


# Plotting the data
ggplot(runtime_avg_rating, aes(x = Runtime_Category, y = Average_Rating)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Average IMDb Rating by Runtime Category",
       x = "Runtime Category",
       y = "Average IMDb Rating") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r echo=FALSE}
# genres (top)
# Convert data from wide to long format for genres
movies_long <- movies %>%
  pivot_longer(cols = starts_with("D"), names_to = "Genre", values_to = "HasGenre") %>%
  filter(HasGenre == 1)

# Calculate number of votes per genre
number_votes <- movies_long %>%
  group_by(Genre) %>%
  summarise(num_Votes = sum(numVotes)) %>%
  arrange(desc(num_Votes))

# Get the top 5 genres with the most amount of votes
top_5_genres_numbvotes <- number_votes %>%
  top_n(5, num_Votes)
top_5_genres_numbvotes
```

```{r echo=FALSE}
# List of genres (dummy variables) to include
top_genres <- c("DDrama", "DAction", "DComedy", "DAdventure", "DCrime")

# Initialize an empty dataframe to store results
combined_data <- data.frame()

# Loop over each genre
for (genre in top_genres) {
  
  # Filter the dataframe to include only movies of the current genre
  genre_movies_df <- subset(movies, movies[[genre]] == TRUE)
  
  # Create a data frame for the average rating per runtime category for the current genre
  runtime_avg_rating_genre <- data.frame(
    Genre = genre, # Add a column for the genre
    Runtime_Category = c("0-30 min", "30-60 min", "60-90 min", "90-120 min", "120-150 min", "150-180 min", ">180 min"),
    Average_Rating = c(
      mean(genre_movies_df$averageRating[genre_movies_df$`0-30 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`30-60 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`60-90 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`90-120 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`120-150 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`150-180 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`>180 min` == TRUE], na.rm = TRUE)
    )
  )
  
  # Combine data for all genres
  combined_data <- rbind(combined_data, runtime_avg_rating_genre)
}

# Convert Runtime_Category into a factor and set the levels to ensure the order is correct
combined_data$Runtime_Category <- factor(combined_data$Runtime_Category, 
                                         levels = c("0-30 min", "30-60 min", "60-90 min", "90-120 min", 
                                                    "120-150 min", "150-180 min", ">180 min"))

# Plotting the data with facets for each genre
ggplot(combined_data, aes(x = Runtime_Category, y = Average_Rating)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Average IMDb Rating by Runtime Category Across Genres",
       x = "Runtime Category",
       y = "Average IMDb Rating") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ Genre)  # Facet the plot by genre

```


```{r echo=FALSE}
# Load necessary libraries
library(ggplot2)
library(dplyr)

# List of genres (dummy variables) to include
genres <- c("DDrama", "DAction", "DComedy", "DAdventure", "DCrime")

# Initialize an empty dataframe to store results
combined_data <- data.frame()

# Loop over each genre
for (genre in genres) {
  
  # Filter the dataframe to include only movies of the current genre
  genre_movies_df <- subset(movies, movies[[genre]] == TRUE)
  
  # Create a data frame for the average rating per runtime category for the current genre
  runtime_avg_rating_genre <- data.frame(
    Genre = genre, # Add a column for the genre
    Runtime_Category = c("0-30 min", "30-60 min", "60-90 min", "90-120 min", "120-150 min", "150-180 min", ">180 min"),
    Average_Rating = c(
      mean(genre_movies_df$averageRating[genre_movies_df$`0-30 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`30-60 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`60-90 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`90-120 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`120-150 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`150-180 min` == TRUE], na.rm = TRUE),
      mean(genre_movies_df$averageRating[genre_movies_df$`>180 min` == TRUE], na.rm = TRUE)
    )
  )
  
  # Combine data for all genres
  combined_data <- rbind(combined_data, runtime_avg_rating_genre)
}

# Convert Runtime_Category into a factor and set the levels to ensure the order is correct
combined_data$Runtime_Category <- factor(combined_data$Runtime_Category, 
                                         levels = c("0-30 min", "30-60 min", "60-90 min", "90-120 min", 
                                                    "120-150 min", "150-180 min", ">180 min"))

# Create the grouped bar plot
ggplot(combined_data, aes(x = Runtime_Category, y = Average_Rating, fill = Genre)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Average IMDb Rating by Runtime Category and Genre",
       x = "Runtime Category",
       y = "Average IMDb Rating") +
  theme_minimal(base_size = 14) +  # Set base text size for readability
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 12),  # Rotate x-axis labels for better fit
    axis.title = element_text(size = 14),  # Increase axis title font size
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5),  # Center and bold title
    panel.grid.major = element_line(color = "gray", linetype = "dashed")  # Add dashed gridlines
  ) +
  scale_fill_brewer(palette = "Set2")  # Use a distinct color palette for genres

```










